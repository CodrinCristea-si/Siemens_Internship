
const questions = {
	"History":[
	  {
	    "id": 1,
	    "text": "Which ancient civilization built the Great Pyramid of Giza?",
	    "answers": [
	      { "id": 1, "text": "Roman Empire" },
	      { "id": 2, "text": "Ancient Greece" },
	      { "id": 3, "text": "Egyptian" },
	      { "id": 4, "text": "Mesopotamian" }
	    ],
	    "correct": 3
	  },
	  {
	    "id": 2,
	    "text": "Who was the first president of the United States?",
	    "answers": [
	      { "id": 5, "text": "Thomas Jefferson" },
	      { "id": 6, "text": "George Washington" },
	      { "id": 7, "text": "John Adams" },
	      { "id": 8, "text": "James Madison" }
	    ],
	    "correct": 6
	  },
	  {
	    "id": 3,
	    "text": "The Industrial Revolution originated in which country?",
	    "answers": [
	      { "id": 9, "text": "Germany" },
	      { "id": 10, "text": "France" },
	      { "id": 11, "text": "England" },
	      { "id": 12, "text": "United States" }
	    ],
	    "correct": 11
	  },
	  {
	    "id": 4,
	    "text": "The Treaty of Versailles was signed at the end of which war?",
	    "answers": [
	      { "id": 13, "text": "World War I" },
	      { "id": 14, "text": "World War II" },
	      { "id": 15, "text": "Korean War" },
	      { "id": 16, "text": "Cold War" }
	    ],
	    "correct": 13
	  },
	  {
	    "id": 5,
	    "text": "Who is credited with painting the famous mural 'The Last Supper'?",
	    "answers": [
	      { "id": 17, "text": "Vincent van Gogh" },
	      { "id": 18, "text": "Michelangelo" },
	      { "id": 19, "text": "Leonardo da Vinci" },
	      { "id": 20, "text": "Pablo Picasso" }
	    ],
	    "correct": 19
	  },
	  {
	    "id": 6,
	    "text": "Which civilization built the city of Machu Picchu?",
	    "answers": [
	      { "id": 21, "text": "Aztec" },
	      { "id": 22, "text": "Mayan" },
	      { "id": 23, "text": "Incan" },
	      { "id": 24, "text": "Egyptian" }
	    ],
	    "correct": 23
	  },
	  {
	    "id": 7,
	    "text": "The Magna Carta was signed in which country?",
	    "answers": [
	      { "id": 25, "text": "Italy" },
	      { "id": 26, "text": "France" },
	      { "id": 27, "text": "England" },
	      { "id": 28, "text": "Spain" }
	    ],
	    "correct": 27
	  },
	  {
	    "id": 8,
	    "text": "Who was the first female Prime Minister of the United Kingdom?",
	    "answers": [
	      { "id": 29, "text": "Margaret Thatcher" },
	      { "id": 30, "text": "Theresa May" },
	      { "id": 31, "text": "Angela Merkel" },
	      { "id": 32, "text": "Indira Gandhi" }
	    ],
	    "correct": 29
	  },
	  {
	    "id": 9,
	    "text": "The Battle of Hastings in 1066 led to the crowning of which English monarch?",
	    "answers": [
	      { "id": 33, "text": "King Edward the Confessor" },
	      { "id": 34, "text": "King William the Conqueror" },
	      { "id": 35, "text": "King Harold II" },
	      { "id": 36, "text": "King Henry I" }
	    ],
	    "correct": 34
	  },
	  {
	    "id": 10,
	    "text": "The ancient wonder known as the Hanging Gardens is associated with which city?",
	    "answers": [
	      { "id": 37, "text": "Rome" },
	      { "id": 38, "text": "Babylon" },
	      { "id": 39, "text": "Athens" },
	      { "id": 40, "text": "Alexandria" }
	    ],
	    "correct": 38
	  }
	],
	"Math":[
	  {
	    "id": 11,
	    "text": "What is the value of π (pi) to two decimal places?",
	    "answers": [
	      { "id": 41, "text": "3.14" },
	      { "id": 42, "text": "3.16" },
	      { "id": 43, "text": "3.12" },
	      { "id": 44, "text": "3.18" }
	    ],
	    "correct": 41
	  },
	  {
	    "id": 12,
	    "text": "What is the formula for the area of a circle?",
	    "answers": [
	      { "id": 45, "text": "A = pi*r^2" },
	      { "id": 46, "text": "A = 2*pi*r" },
	      { "id": 47, "text": "A = pi*d" },
	      { "id": 48, "text": "A = 1/2*pi*r" }
	    ],
	    "correct": 45
	  },
	  {
	    "id": 13,
	    "text": "What is the square root of 144?",
	    "answers": [
	      { "id": 49, "text": "12" },
	      { "id": 50, "text": "14" },
	      { "id": 51, "text": "10" },
	      { "id": 52, "text": "16" }
	    ],
	    "correct": 49
	  },
	  {
	    "id": 14,
	    "text": "What is the result of 8 / (2 + 2) * 3?",
	    "answers": [
	      { "id": 53, "text": "6" },
	      { "id": 54, "text": "3" },
	      { "id": 55, "text": "9" },
	      { "id": 56, "text": "12" }
	    ],
	    "correct": 54
	  },
	  {
	    "id": 15,
	    "text": "What is the value of 'x' in the equation 2x + 5 = 15?",
	    "answers": [
	      { "id": 57, "text": "5" },
	      { "id": 58, "text": "10" },
	      { "id": 59, "text": "6" },
	      { "id": 60, "text": "7" }
	    ],
	    "correct": 57
	  },
	  {
	    "id": 16,
	    "text": "If a triangle has angles measuring 45, 45, and 90 degrees, what type of triangle is it?",
	    "answers": [
	      { "id": 61, "text": "Equilateral" },
	      { "id": 62, "text": "Isosceles" },
	      { "id": 63, "text": "Scalene" },
	      { "id": 64, "text": "Right-angled" }
	    ],
	    "correct": 64
	  },
	  {
	    "id": 17,
	    "text": "What is the sum of the interior angles in a hexagon?",
	    "answers": [
	      { "id": 65, "text": "360°" },
	      { "id": 66, "text": "540°" },
	      { "id": 67, "text": "720°" },
	      { "id": 68, "text": "450°" }
	    ],
	    "correct": 65
	  },
	  {
	    "id": 18,
	    "text": "What is the value of 5! (factorial)?",
	    "answers": [
	      { "id": 69, "text": "120" },
	      { "id": 70, "text": "60" },
	      { "id": 71, "text": "20" },
	      { "id": 72, "text": "240" }
	    ],
	    "correct": 69
	  },
	  {
	    "id": 19,
	    "text": "Solve the following equation: 3x - 7 = 8",
	    "answers": [
	      { "id": 73, "text": "x = 5" },
	      { "id": 74, "text": "x = 6" },
	      { "id": 75, "text": "x = 3" },
	      { "id": 76, "text": "x = 4" }
	    ],
	    "correct": 73
	  },
	  {
	    "id": 20,
	    "text": "What is the value of log10(100)?",
	    "answers": [
	      { "id": 77, "text": "1" },
	      { "id": 78, "text": "10" },
	      { "id": 79, "text": "2" },
	      { "id": 80, "text": "100" }
	    ],
	    "correct": 79
	  }
	],
	"Geography":[
	  {
	    "id": 21,
	    "text": "What is the capital city of Australia?",
	    "answers": [
	      { "id": 81, "text": "Melbourne" },
	      { "id": 82, "text": "Sydney" },
	      { "id": 83, "text": "Canberra" },
	      { "id": 84, "text": "Perth" }
	    ],
	    "correct": 83
	  },
	  {
	    "id": 22,
	    "text": "Which river is the longest in the world?",
	    "answers": [
	      { "id": 85, "text": "Amazon River" },
	      { "id": 86, "text": "Nile River" },
	      { "id": 87, "text": "Yangtze River" },
	      { "id": 88, "text": "Mississippi River" }
	    ],
	    "correct": 86
	  },
	  {
	    "id": 23,
	    "text": "What is the highest mountain in Africa?",
	    "answers": [
	      { "id": 89, "text": "Mount Kilimanjaro" },
	      { "id": 90, "text": "Mount Kenya" },
	      { "id": 91, "text": "Mount Elgon" },
	      { "id": 92, "text": "Mount Stanley" }
	    ],
	    "correct": 89
	  },
	  {
	    "id": 24,
	    "text": "Which country is known as the Land of the Rising Sun?",
	    "answers": [
	      { "id": 93, "text": "China" },
	      { "id": 94, "text": "South Korea" },
	      { "id": 95, "text": "Japan" },
	      { "id": 96, "text": "Vietnam" }
	    ],
	    "correct": 95
	  },
	  {
	    "id": 25,
	    "text": "Which desert is the largest in the world?",
	    "answers": [
	      { "id": 97, "text": "Sahara Desert" },
	      { "id": 98, "text": "Gobi Desert" },
	      { "id": 99, "text": "Arabian Desert" },
	      { "id": 100, "text": "Antarctic Desert" }
	    ],
	    "correct": 97
	  },
	  {
	    "id": 26,
	    "text": "What is the capital city of Canada?",
	    "answers": [
	      { "id": 101, "text": "Montreal" },
	      { "id": 102, "text": "Toronto" },
	      { "id": 103, "text": "Ottawa" },
	      { "id": 104, "text": "Vancouver" }
	    ],
	    "correct": 103
	  },
	  {
	    "id": 27,
	    "text": "Which country is both in Europe and Asia?",
	    "answers": [
	      { "id": 105, "text": "Russia" },
	      { "id": 106, "text": "Turkey" },
	      { "id": 107, "text": "Kazakhstan" },
	      { "id": 108, "text": "Ukraine" }
	    ],
	    "correct": 105
	  },
	  {
	    "id": 28,
	    "text": "What is the largest ocean in the world?",
	    "answers": [
	      { "id": 109, "text": "Atlantic Ocean" },
	      { "id": 110, "text": "Indian Ocean" },
	      { "id": 111, "text": "Arctic Ocean" },
	      { "id": 112, "text": "Pacific Ocean" }
	    ],
	    "correct": 112
	  },
	  {
	    "id": 29,
	    "text": "Which country is known as the 'Land of a Thousand Lakes'?",
	    "answers": [
	      { "id": 113, "text": "Sweden" },
	      { "id": 114, "text": "Finland" },
	      { "id": 115, "text": "Norway" },
	      { "id": 116, "text": "Denmark" }
	    ],
	    "correct": 114
	  },
	  {
	    "id": 30,
	    "text": "What is the world's largest island?",
	    "answers": [
	      { "id": 117, "text": "Greenland" },
	      { "id": 118, "text": "Australia" },
	      { "id": 119, "text": "Madagascar" },
	      { "id": 120, "text": "Borneo" }
	    ],
	    "correct": 117
	  }
	],
	"Astronomy":[
	  {
	    "id": 31,
	    "text": "Which planet is known as the 'Red Planet'?",
	    "answers": [
	      { "id": 121, "text": "Jupiter" },
	      { "id": 122, "text": "Saturn" },
	      { "id": 123, "text": "Mars" },
	      { "id": 124, "text": "Uranus" }
	    ],
	    "correct": 123
	  },
	  {
	    "id": 32,
	    "text": "What is the largest moon in the solar system?",
	    "answers": [
	      { "id": 125, "text": "Ganymede" },
	      { "id": 126, "text": "Europa" },
	      { "id": 127, "text": "Titan" },
	      { "id": 128, "text": "Callisto" }
	    ],
	    "correct": 125
	  },
	  {
	    "id": 33,
	    "text": "What is the name of the galaxy that contains our solar system?",
	    "answers": [
	      { "id": 129, "text": "Andromeda" },
	      { "id": 130, "text": "Whirlpool" },
	      { "id": 131, "text": "Milky Way" },
	      { "id": 132, "text": "Sombrero" }
	    ],
	    "correct": 131
	  },
	  {
	    "id": 34,
	    "text": "What is the process by which stars produce energy?",
	    "answers": [
	      { "id": 133, "text": "Fusion" },
	      { "id": 134, "text": "Fission" },
	      { "id": 135, "text": "Eclipse" },
	      { "id": 136, "text": "Combustion" }
	    ],
	    "correct": 133
	  },
	  {
	    "id": 35,
	    "text": "Which planet has the most moons in our solar system?",
	    "answers": [
	      { "id": 137, "text": "Saturn" },
	      { "id": 138, "text": "Jupiter" },
	      { "id": 139, "text": "Neptune" },
	      { "id": 140, "text": "Uranus" }
	    ],
	    "correct": 138
	  },
	  {
	    "id": 36,
	    "text": "What is the name of the phenomenon where a total solar eclipse creates a ring of light around the moon?",
	    "answers": [
	      { "id": 141, "text": "Lunar eclipse" },
	      { "id": 142, "text": "Solar corona" },
	      { "id": 143, "text": "Aurora borealis" },
	      { "id": 144, "text": "Diamond ring effect" }
	    ],
	    "correct": 144
	  },
	  {
	    "id": 37,
	    "text": "Which star is at the center of our solar system?",
	    "answers": [
	      { "id": 145, "text": "Alpha Centauri" },
	      { "id": 146, "text": "Proxima Centauri" },
	      { "id": 147, "text": "Polaris" },
	      { "id": 148, "text": "Sun" }
	    ],
	    "correct": 148
	  },
	  {
	    "id": 38,
	    "text": "What is the name of the first artificial satellite launched into space?",
	    "answers": [
	      { "id": 149, "text": "Hubble" },
	      { "id": 150, "text": "Sputnik 1" },
	      { "id": 151, "text": "Voyager 1" },
	      { "id": 152, "text": "Apollo 11" }
	    ],
	    "correct": 150
	  },
	  {
	    "id": 39,
	    "text": "What is the name of the closest galaxy to the Milky Way?",
	    "answers": [
	      { "id": 153, "text": "Andromeda" },
	      { "id": 154, "text": "Triangulum" },
	      { "id": 155, "text": "Pinwheel" },
	      { "id": 156, "text": "Whirlpool" }
	    ],
	    "correct": 153
	  },
	  {
	    "id": 40,
	    "text": "What is the name of the largest known planet in our solar system?",
	    "answers": [
	      { "id": 157, "text": "Saturn" },
	      { "id": 158, "text": "Jupiter" },
	      { "id": 159, "text": "Uranus" },
	      { "id": 160, "text": "Neptune" }
	    ],
	    "correct": 158
	  }
	],
	"Chemistry":[
	  {
	    "id": 41,
	    "text": "What is the chemical symbol for gold?",
	    "answers": [
	      { "id": 161, "text": "Go" },
	      { "id": 162, "text": "Au" },
	      { "id": 163, "text": "Gl" },
	      { "id": 164, "text": "Gd" }
	    ],
	    "correct": 162
	  },
	  {
	    "id": 42,
	    "text": "What is the chemical formula for water?",
	    "answers": [
	      { "id": 165, "text": "CO2" },
	      { "id": 166, "text": "H2O" },
	      { "id": 167, "text": "H2CO3" },
	      { "id": 168, "text": "H2O2" }
	    ],
	    "correct": 166
	  },
	  {
	    "id": 43,
	    "text": "What is the lightest element?",
	    "answers": [
	      { "id": 169, "text": "Hydrogen" },
	      { "id": 170, "text": "Oxygen" },
	      { "id": 171, "text": "Helium" },
	      { "id": 172, "text": "Carbon" }
	    ],
	    "correct": 169
	  },
	  {
	    "id": 44,
	    "text": "Which gas do plants use in photosynthesis?",
	    "answers": [
	      { "id": 173, "text": "Oxygen" },
	      { "id": 174, "text": "Carbon dioxide" },
	      { "id": 175, "text": "Nitrogen" },
	      { "id": 176, "text": "Hydrogen" }
	    ],
	    "correct": 174
	  },
	  {
	    "id": 45,
	    "text": "What is the pH value of a neutral substance?",
	    "answers": [
	      { "id": 177, "text": "7" },
	      { "id": 178, "text": "8" },
	      { "id": 179, "text": "6" },
	      { "id": 180, "text": "9" }
	    ],
	    "correct": 177
	  },
	  {
	    "id": 46,
	    "text": "Which gas makes up the majority of the Earth's atmosphere?",
	    "answers": [
	      { "id": 181, "text": "Carbon dioxide" },
	      { "id": 182, "text": "Oxygen" },
	      { "id": 183, "text": "Nitrogen" },
	      { "id": 184, "text": "Hydrogen" }
	    ],
	    "correct": 183
	  },
	  {
	    "id": 47,
	    "text": "What is the chemical symbol for sodium?",
	    "answers": [
	      { "id": 185, "text": "Sd" },
	      { "id": 186, "text": "So" },
	      { "id": 187, "text": "Na" },
	      { "id": 188, "text": "No" }
	    ],
	    "correct": 187
	  },
	  {
	    "id": 48,
	    "text": "What is the process of converting a solid directly to a gas called?",
	    "answers": [
	      { "id": 189, "text": "Condensation" },
	      { "id": 190, "text": "Melting" },
	      { "id": 191, "text": "Sublimation" },
	      { "id": 192, "text": "Evaporation" }
	    ],
	    "correct": 191
	  },
	  {
	    "id": 49,
	    "text": "Which element is essential for combustion to occur?",
	    "answers": [
	      { "id": 193, "text": "Oxygen" },
	      { "id": 194, "text": "Hydrogen" },
	      { "id": 195, "text": "Nitrogen" },
	      { "id": 196, "text": "Carbon" }
	    ],
	    "correct": 193
	  },
	  {
	    "id": 50,
	    "text": "What is the chemical symbol for iron?",
	    "answers": [
	      { "id": 197, "text": "Fe" },
	      { "id": 198, "text": "Ir" },
	      { "id": 199, "text": "In" },
	      { "id": 200, "text": "Io" }
	    ],
	    "correct": 197
	  }
	]
}

class User{
	constructor(username){
		this.username =  username;
		this.questions = [];
		this.current_index = 0;
		this.score = 0;
	}
	reset_game(){
	 	this.questions = [];
		this.current_index = 0;
		this.score = 0;
	}
}

class Answer{
	constructor(id, text){
		this.id = id;
		this.text = text;
	}
}

class Question{
	constructor(id, text, domain, answers, corect_answer_id){
		this.id = id;
		this.text = text;
		this.domain = domain;
		this.answers = answers;
		this.corect_answer_id = corect_answer_id;
	}
	get_answer(index){
		return this.answers[index - 1];
	}

	corect_answer(){
		let answer = this.answers.find(ans => ans.id == this.corect_answer_id);
		return answer;
	}
}

var sessions = {}

/*
	Extract a number_of_questions random questions from that domain_name
	:return: a list of questions (JSON format)
*/
function extract_questions_from_domain(number_of_questions, domain_name){
	let total_number_of_questions_stored_in_domain = questions[domain_name].length;

	if (number_of_questions <= 0) return [];
	else if (total_number_of_questions_stored_in_domain <= number_of_questions){
		return questions[domain_name];
	}
	else{
		let extracted_questions_indexes = [];
		// extract the indexes for the selected questions
		while (extracted_questions_indexes.length < number_of_questions){
			let extracted_question_index = Math.floor((Math.random() * questions[domain_name].length));
			while(extracted_questions_indexes.indexOf(extracted_question_index) != -1){
				extracted_question_index = Math.floor((Math.random() * questions[domain_name].length));
			}
			extracted_questions_indexes.push(extracted_question_index);
		}
		// convert from indexes to the actual elements
		let extracted_questions = [];
		for (let index of extracted_questions_indexes){
			extracted_questions.push(questions[domain_name][index]);
		}
		return extracted_questions;
	}
}

/*
	Gets the total number of questions from pool
*/
function get_total_number_of_questions_available(){
	let total_number_of_questions = 0;
	for (let domain of Object.keys(questions)){
		total_number_of_questions += questions[domain].length;
	}
	return total_number_of_questions;
}

/* 
	Gets a dictionary with the number of questions for each domain
*/
function get_the_number_of_questions_per_domain(){
	let total_number_of_questions_per_domain = {};
	for (let domain of Object.keys(questions)){
		total_number_of_questions_per_domain[domain] = questions[domain].length;
	}
	return total_number_of_questions_per_domain;
}

/* 
 	Mathematically distribute the impact over a number of columns.
	Eg: array_of_numbers [7,3,8,3,6], after sorting is [8,7,6,3,3]	
		number_of_elements_to_extract is 22

	Get the average number of elements to extract for each column that has elements( 22/5 = 4)
	For each column extract with the avarage (if not possible, extract it all)
	After that the array_of_numbers is [4,3,2,0,0] and there were extracted 18 elements, 4 more to go.

	Repeate the same process until the array_of_numbers has only 0 or all the necessary elements were extracted
	3 non-zero columns (4,3,2) and the average is 4/3 = 1
	Extract the average from each remaining non-zero column 
	After that the array_of_numbers is [3,2,1,0,0] and there were extracted 21 elements, 1 more to go.

	3 non-zero columns (3,2,1) and the average is 1/3 = 0, so we use the remainder 1%3 = 1
	Extract the average from each remaining non-zero column 
	After that the array_of_numbers is [2,2,1,0,0] and there were extracted 22 elements, 0 more to go.

	So after the impact distribution the remaining array is [2,2,1,0,0].

*/
function distrubute_impact_per_columns(array_of_numbers, number_of_elements_to_extract){
	let number_of_non_zero_columns = array_of_numbers.filter(el => el > 0).length;
	while (number_of_elements_to_extract > 0 && number_of_non_zero_columns > 0){
		number_of_non_zero_columns = array_of_numbers.filter(el => el > 0).length;
		let nr_extracted_elements_per_column = Math.floor(number_of_elements_to_extract / number_of_non_zero_columns);
		if(nr_extracted_elements_per_column == 0)
			nr_extracted_elements_per_column = Math.floor(number_of_elements_to_extract % number_of_non_zero_columns);
		for (let index_column in array_of_numbers){
			if (array_of_numbers[index_column] >= nr_extracted_elements_per_column){
				if (number_of_elements_to_extract >= nr_extracted_elements_per_column){
					number_of_elements_to_extract -= nr_extracted_elements_per_column; 
					array_of_numbers[index_column] -= nr_extracted_elements_per_column;
				}
				else{
					array_of_numbers[index_column] -= number_of_elements_to_extract;
					number_of_elements_to_extract = 0;
				}
				
			}else{
				if (number_of_elements_to_extract >= array_of_numbers[index_column]){
					number_of_elements_to_extract -= array_of_numbers[index_column];
					array_of_numbers[index_column] = 0;
				}
				else{
					array_of_numbers[index_column] -= number_of_elements_to_extract;
					number_of_elements_to_extract = 0;
				}
			}
		}


	}
	return array_of_numbers;
}

//console.log(distrubute_impact_per_columns([8,7,6,3,3],3));

/* 
	Calculate how many questions should be extracted for each domain
	:return: A dictionary with DOMAIN_NAME: NUMBER_OF_QUESTIONS_TO_EXTRACT
*/
function decide_how_many_questions_per_domain(number_of_questions_to_extract){
	let nr_questions_per_domain = {}
	let total_number_of_questions_stored = get_total_number_of_questions_available();
	// need to extract all the questions from the pool
	if (total_number_of_questions_stored <= number_of_questions_to_extract){
		for (let domain of Object.keys(questions)){
			nr_questions_per_domain[domain] = questions[domain].length;
		}
		return nr_questions_per_domain;
	}
	// fewer questions than the number of domains
	else if(number_of_questions_to_extract <= Object.keys(questions).length){
		for (let domain of Object.keys(questions)){
			if (number_of_questions_to_extract > 0){
				nr_questions_per_domain[domain] = 1;
				number_of_questions_to_extract--;
			}
			else{
				nr_questions_per_domain[domain] = 0;
			}
		}
		return nr_questions_per_domain;
	}
	else{
		let nr_questions_per_domain = get_the_number_of_questions_per_domain();

		let nr_questions_per_domain_list = Object.keys(nr_questions_per_domain).map(function(dom){
			return [dom,nr_questions_per_domain[dom]]
		}); // convert from dict to a list of pairs [domain, nr question of that domain]

		nr_questions_per_domain_list.sort(function(elem1,elem2){
			return elem1[1] - elem2[1];
		}); // sort descending order by the number of questions

		let initial_array_of_numbers = nr_questions_per_domain_list.map(elem => elem[1]); // get only the number of questions;
		let remaining_questions_per_domain = distrubute_impact_per_columns(initial_array_of_numbers,number_of_questions_to_extract);

		nr_questions_per_domain = {}
		for(let index_domain in nr_questions_per_domain_list){
			let domain = nr_questions_per_domain_list[index_domain];
			let domain_name = domain[0];
			let domain_nr_of_questions = domain[1];
			nr_questions_per_domain[domain_name] = domain_nr_of_questions - remaining_questions_per_domain[index_domain];
		}
		return nr_questions_per_domain;
	}
}

/* 
	Shuffle an array
*/
function shuffle_array(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1)); 
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

/* 
	Get a list of questions randomly selected for a session
*/
function shuffle_questions(number_of_questions){
	let extracted_questions = [];
	let to_extract_per_domain = decide_how_many_questions_per_domain(number_of_questions);
	for (let domain of Object.keys(to_extract_per_domain)){
		let domain_name = domain;
		let how_many_to_extract = to_extract_per_domain[domain];
		let questions_extracted_domain = extract_questions_from_domain(how_many_to_extract, domain_name);
		extracted_questions= extracted_questions.concat(questions_extracted_domain);
	}
	extracted_questions = shuffle_array(extracted_questions);
	return extracted_questions;
}
// let question_need = shuffle_questions(3);
// console.log(question_need);
//console.log(question_need.map(el => el["id"]));

/* 
	Get the maximum number of questions to be answered during a session
*/
function get_maximum_nr_questions_session(){
	return 6;
}

/* 
	Create a session for a user or reset one
*/
function add_username(username){
	sessions = JSON.parse(localStorage.getItem('sessions'));
	if (sessions == null){
		sessions = {};
	}
	if (Object.keys(sessions).length == 0 || Object.keys(sessions).indexOf(username) == -1){
		sessions[username] = {
			"username":"",
			"questions": [],
			"current_index":-1,
			"score": 0
		};
		sessions[username]["username"] = username;

	}
	let max_nr_questions = get_maximum_nr_questions_session()
	sessions[username]["questions"] = shuffle_questions(max_nr_questions);
	sessions[username]["current_index"] = -1;
	sessions[username]["score"] = 0;

	localStorage.setItem('sessions', JSON.stringify(sessions));
}

/*
 Get the domain for a specific question id
*/
function find_domain_for_question(id_question){
	let domain_to_be_found = null;
	for (let domain of Object.keys(questions)){
		for(let question of questions[domain]){
			if (question["id"] == id_question){
				domain_to_be_found = domain;
				break;
			}
		}
	}
	return domain_to_be_found;
}

/* 
	Get the next question for the session of a user
*/
function send_next_question(username){
	sessions = JSON.parse(localStorage.getItem('sessions'));
	//console.log(sessions, username)
	let current_user = sessions[username];
	//console.log(current_user)
	current_user["current_index"] += 1;
	let next_question = current_user["questions"][current_user["current_index"]];
	localStorage.setItem('sessions', JSON.stringify(sessions));

	let answers = []
	for(let answer_saved of next_question["answers"]){ 
		answers.push(new Answer(answer_saved["id"], answer_saved["text"]));
	}
	let domain = find_domain_for_question(next_question["id"]);
	let question = new Question(next_question["id"], next_question["text"], domain, answers, next_question["correct"]);

	return question;
}

/* 
	Check the answers correctness 
*/
function check_question(username, answer){
	sessions = JSON.parse(localStorage.getItem('sessions'));
	let current_user = sessions[username];
	let current_question = current_user["questions"][current_user["current_index"]];
	if (current_question["correct"] == answer){
		current_user["score"] += 1;
	}
	localStorage.setItem('sessions', JSON.stringify(sessions));
}

/*
	Get the score for a specific user
*/
function get_score(username){
	sessions = JSON.parse(localStorage.getItem('sessions'));
	let current_user = sessions[username];
	return current_user["score"];
}


